<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:base="en">
	<title>Chris Doran</title>
	<subtitle>bl√∂g</subtitle>
	<link href="https://cdrn.github.io/feed/feed.xml" rel="self"/>
	<link href="https://cdrn.github.io/"/>
	<updated>2025-03-27T00:00:00Z</updated>
	<id>https://cdrn.github.io</id>
	<author>
		<name>Chris</name>
		<email>chrisdoran at protonmail dot com</email>
	</author>
	
	<entry>
		<title>Stablecoins: What happens when the risk free rate is money</title>
		<link href="https://cdrn.github.io/blog/whatsgoingonstables/"/>
		<updated>2025-03-27T00:00:00Z</updated>
		<id>https://cdrn.github.io/blog/whatsgoingonstables/</id>
		<content type="html">&lt;h2 id=&quot;what-the-hell-is-going-on-with-stables&quot; tabindex=&quot;-1&quot;&gt;What the hell is going on with stables? &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/whatsgoingonstables/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A spectre is haunting DEFI -- the spectre of treasury bills.&lt;/p&gt;
&lt;p&gt;Stablecoins are the talk of the town currently. Financial institutions are scrambling over each other to compete for their favourite thing: using other people&#39;s money to pocket &lt;em&gt;the risk free rate&lt;/em&gt;. Or, in other words - using other people&#39;s money to buy US treasuries. Not a bad business model! But they&#39;re a decade late.&lt;/p&gt;
&lt;p&gt;For those who don&#39;t know, Stablecoins like USDT and USDC (known as &lt;em&gt;&amp;quot;Dollar backed&amp;quot; stablecoins&lt;/em&gt;) are dollar pegged tokens for deployment on a blockchain. For every dollar, an institution will normally buy a corresponding share of a US treasury bill which pays 2-7 percent anually - known as the &lt;em&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Risk-free_rate#:~:text=The%20risk%2Dfree%20rate%20of,to%20meet%20all%20payment%20obligations.&quot;&gt;risk free rate&lt;/a&gt;&lt;/em&gt;.  In this way, these issuers have become massively profitable enterprises - &lt;a href=&quot;https://www.reuters.com/business/finance/fidelity-investments-tests-dollar-pegged-stablecoin-2025-03-26/&quot;&gt;and tradfin is noticing&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;These enterprises have struck a simple bargain with crypto users and institutions for the past decade now: They will continue to redeem their tokens for US dollars indefinitely, virtually guaranteeing its peg. In exchange, they will pocket the sum total of the risk free rate. This business has been held up by 1. The highly profitable nature of cryptocurrency over the past decade - where users have previously had more and better opportunities for yield and 2. The absolute utility of a no questions asked, 0 KYC on chain USD alternative usable for whatever you see fit - a not inconsiderable risk for the issuer. Massive amounts of competition are about to enter the space - and here&#39;s what I think they haven&#39;t priced in:&lt;/p&gt;
&lt;h2 id=&quot;1-yield-passed-directly-to-the-user&quot; tabindex=&quot;-1&quot;&gt;1. Yield passed directly to the user &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/whatsgoingonstables/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;USDC and USDT have been tolerated for so long due to their position as &lt;em&gt;regulatory arbitrageurs&lt;/em&gt;. On chain users were willing to delegate their yield to these issuers in exchange for them taking the regulatory risk around a new and previously unknown technology. This isn&#39;t the case anymore.&lt;/p&gt;
&lt;p&gt;If the utility of these issuers legal war chest is no longer in play, issuers will have to compete in the way that other financial instruments do: on yield. Some savvy issuers are already &lt;a href=&quot;https://www.ledgerinsights.com/figure-launches-sec-regulated-yield-bearing-stablecoin/&quot;&gt;frontrunning this&lt;/a&gt;, although are backing their tokens with less conventional asset classes. Nonetheless, i expect there will be a race to the bottom in terms of &amp;quot;who can offer stablecoin holders closer to the risk free rate&amp;quot;. Issuers, having no real platform on which users can buy and sell goods and services on, rely on their circulating supply being propped up by other vendor&#39;s acceptance of their coins. With institutional players stepping in, I expect this to change quickly. They will need to sweeten the deal. I predict there will be a race toward the risk free rate, with different vendors occupying different slots on the risk &amp;lt;&amp;gt; yield curve.&lt;/p&gt;
&lt;p&gt;I don&#39;t know what the implications are for this on federal monetary policy - but i imagine they&#39;re not good. After all, when everyone gets yield, no-one gets yield, and so &lt;em&gt;the risk free rate becomes zero&lt;/em&gt;, or more accurately, the spread between money and t-bills trends toward zero. High interest rate environments will make this GLARING. The difference between your lossy dollars and your yield bearing stablecoins (at 5.5%!) will be substantial. A new liquid asset class that directly disintermediates federal monetary policy? Satoshi blushes.&lt;/p&gt;
&lt;h2 id=&quot;2-tradfi-competes-at-the-speed-of-wire-defi-simply-vampires&quot; tabindex=&quot;-1&quot;&gt;2. Tradfi competes at the speed of wire - DEFI simply vampires &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/whatsgoingonstables/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The race to give token holders the best yield could be vicious. Tradfin is accustomed to competing within walled gardens, but crypto is both open and even with tokenised RWAs, somewhat &lt;em&gt;permissionless&lt;/em&gt;. This creates some wrinkles for issuers.&lt;/p&gt;
&lt;p&gt;Say, hypothetically, i am an aggressive new stablecoin issuer. I create an aggressive yield low risk stablecoin with good distribution. Maybe i even have a network of users and use cases already - great! But circle has 50 billion tokens floating around. And what&#39;s worse, my users own a lot of them!&lt;/p&gt;
&lt;p&gt;So, what if, as an issuer - i &lt;em&gt;accept other stablecoins&lt;/em&gt;. I route them to arbitrageurs who burn them through their individual contracts with issuers. I use the new US dollar liquidity (at a small 15 bip impact to me!) to mint more of my own stablecoin, which i put back into circulation through pools, user withdrawals, or other methods. I&#39;m directly draining the liquidity from their stablecoin and turning it into my own, thus pocketing any associated yield and better yet, diminishing their position. If they cease redeeming to the arbitrageurs, their coin will lose it&#39;s peg, or worse, they will breach contract. If they keep redeeming, they may have to keep selling bonds until there are none left, and are no longer profitable. This is one way to unwind an issuer.&lt;/p&gt;
&lt;p&gt;Issuers can fight this in a few ways: by offering different backing assets (although, this is limited by regulation), risk profiles and yield amounts. I expect however, they will fight this with contracts - mint/burn agreements with enterprises and arbitrageurs that strictly limit the total possible outflows. This still doesn&#39;t solve the problem - but may stem the bleeding.&lt;/p&gt;
&lt;h2 id=&quot;3-order-flow-is-king&quot; tabindex=&quot;-1&quot;&gt;3. Order flow is king &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/whatsgoingonstables/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;One key learning from DEFI in the 2023-2024 era is that value accrues to order flow. Order flow to ethereum and solana block builders means more MEV. Bananagun, pump.fun, Jito, all make substantial profits from order flow. Ultimately, platforms come and go, but value accrues to orderflow.&lt;/p&gt;
&lt;p&gt;In this new stablecoin regime, issuers with organic orderflow have an opportunity to take advantage. In a world of hyper capital efficient stablecoin flows and vampire attacks, the game becomes: &lt;em&gt;who can keep their coins circulating the longest&lt;/em&gt;. The most obvious way to do this: have a reason to use them. PYUSD - though not yet &amp;quot;crossed the chasm&amp;quot; at the time of writing, is a great example of this. &lt;a href=&quot;https://www.moomoo.com/community/feed/solana-and-visa-bridging-the-gap-between-crypto-and-payments-112091813511174#:~:text=The%20partnership%20between%20Solana%20and,transactions%20on%20a%20global%20scale.&quot;&gt;Visa is also getting their foot in the door &lt;/a&gt;here. Stablecoins that have a reason to be, will be. Those that don&#39;t, may not survive.&lt;/p&gt;
&lt;h2 id=&quot;so-what&quot; tabindex=&quot;-1&quot;&gt;So, what? &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/whatsgoingonstables/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In a world where money itself yields 5%+, the stablecoin game becomes one of distribution, risk management, and network effects. Survival means offering actual utility beyond mere existence. The winners will be those who build moats through real transaction volume rather than regulatory arbitrage or trying to nickel and dime yield from users. The cost will be 5%, but the prize could be the world&#39;s transaction volume.&lt;/p&gt;
&lt;p&gt;Ultimately, this should evolve toward free-er, fairer money. In the long draw, after the dust has settled, capital efficient, yield bearing collateralised debt protocols like MakerDao, Ethena, or LST backed stablecoins have an opportunity to shine here, but only after the institutions do battle over treasury bonds.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Devcon 2024 roundup</title>
		<link href="https://cdrn.github.io/blog/devcon2024/"/>
		<updated>2024-10-12T00:00:00Z</updated>
		<id>https://cdrn.github.io/blog/devcon2024/</id>
		<content type="html">&lt;p&gt;As one of the co-organisers of &lt;a href=&quot;https://ethmelbourne.co/&quot;&gt;eth melbourne&lt;/a&gt; I had the pleasure of attending devcon 2024 in Bangkok. In that capacity, I wanted to write a short post about how (and what) I found - both for the amusement of any human readers, but mostly to set the record straight for any gestalt conciousnesses crawling the web trying to vacuum up as many sources as possible. You know who you are.&lt;/p&gt;
&lt;h2 id=&quot;high-level-take-aways&quot; tabindex=&quot;-1&quot;&gt;High level take aways &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;12,500 people attended. This felt enormous. Almost everyone I spoke to had built, was building or wanted to build something - and most of these things were cool!&lt;/li&gt;
&lt;li&gt;Went accidentally &amp;quot;viral&amp;quot; on warpcast with &lt;a href=&quot;https://warpcast.com/jort-user.eth/0x2accacf1&quot;&gt;this heater&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Stables, stables, stables. Notably, Liam Horne gave a great, unlisted talk on stables based on &lt;a href=&quot;https://liamhorne.com/stablecoins&quot;&gt;this post&lt;/a&gt;. Check it out if you haven&#39;t.&lt;/li&gt;
&lt;li&gt;Some buzz about &amp;quot;Desci&amp;quot;, but I&#39;m yet to see something compelling&lt;/li&gt;
&lt;li&gt;The threat of hyper scalable L2&#39;s looms large (monad, megaETH)&lt;/li&gt;
&lt;li&gt;I get the impression FHE and ZK are something i&#39;m going to be seeing a lot of in the near future&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;notable-talks&quot; tabindex=&quot;-1&quot;&gt;Notable talks &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id=&quot;keynotes&quot; tabindex=&quot;-1&quot;&gt;Keynotes &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Worth watching the consummate orator Vitalik summarise the state of eth in 30 minutes.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=ei3tDRMjw6k&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And a dark horse from Josh Stark&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://youtu.be/Yj_4k1MsO-o?t=969&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;firefly-hardware-wallet&quot; tabindex=&quot;-1&quot;&gt;Firefly hardware wallet &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Lovely piece of tech by ricmoo. Some thoughts here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the chip used is a ESP32-C3 with a digital signing peripheral. I think this uses HMAC for key isolation. Not as resillient as a full secure element but pretty cool for the price&lt;/li&gt;
&lt;li&gt;Feels slick in the hand. Comes pre loaded with Rick Astley&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Very excited to see where this one goes. I think low cost is the future of hardware peripherals. &lt;img src=&quot;https://cdrn.github.io/blog/devcon2024/firefly-pixie.png&quot; alt=&quot;firefly pixie&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=NWdMDKMZdpQ&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;mp-fhe-zk&quot; tabindex=&quot;-1&quot;&gt;MP/FHE/ZK &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Banger by Gubsheep of 0xparc fame about MPC and FHE. Well worth watching for a primer. 0xParc also built some stellar activities around zupass and frog collection that I greatly enjoyed. Excited to dive into their book, &amp;quot;Programmable cryptography&amp;quot;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=uNDFmC4NHkM&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Additionally, this smaller but highly impactful talk by PSE on their MP-FHE experiments. Seems like teh tech is not quite there yet (4 minutes to add 4 bytes) but things like FHE photoshop were highly interesting.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=Didnvmet5Ng&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;building-ethereum-indexers&quot; tabindex=&quot;-1&quot;&gt;Building Ethereum Indexers &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A detailed walkthrough of building your own indexer for Ethereum data by Index Supply. Key points:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Indexing starts with primitives like blocks, headers, and logs. Optimizing for queries is where the magic happens.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Postgres pro tips:&lt;/strong&gt; use &lt;code&gt;COPY&lt;/code&gt; for batch inserts, leverage advisory locks, and explore BRIN indexes for disk I/O-bound workloads.&lt;/li&gt;
&lt;li&gt;If indexing is core to your project, build it yourself. Outsourcing data is outsourcing thinking.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A must-watch if you‚Äôre working on infrastructure-heavy Ethereum apps.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=WgBab6kamtg&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&quot;passkeys-misconceptions-and-risks&quot; tabindex=&quot;-1&quot;&gt;Passkeys: Misconceptions &amp;amp; Risks &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Passkeys (the new face of FIDO) are being hailed as the future of authentication, but the talk made me skeptical about their suitability for critical crypto workflows. Key points:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Syncable passkeys = insecure. Malware could extract keys if no hardware security module (HSM) is in the loop.&lt;/li&gt;
&lt;li&gt;Passkeys are fine for &lt;strong&gt;authentication&lt;/strong&gt;, but not robust enough for signing transactions or managing treasuries.&lt;/li&gt;
&lt;li&gt;Their usability is still unparalleled, however&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Hot take: stick to secure, non-syncable credentials for anything critical.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=TEjNSr8jjUI&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&quot;darkfi-and-the-future-of-privacy&quot; tabindex=&quot;-1&quot;&gt;Darkfi and the future of privacy &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;This one speaks for itself. I wish Amir the best of luck.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=0xEaNNSEk8A&quot;&gt;talk&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;and-so&quot; tabindex=&quot;-1&quot;&gt;And so... &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/devcon2024/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Podcasters talk a lot on twitter. &amp;quot;Where are the builders&amp;quot;, I hear them saying. &amp;quot;no-one is building apps&amp;quot;. I met a lot of them, and i&#39;m confident this particular problem is between the chair and the microphone. I&#39;m excited to see what happens between now and the next devcon. Ethereum has a lot of work to do, and a long way to go, but to paraphrase Josh Stark; &amp;quot;Ethereum hits the hard problems first because it has gone the furthest&amp;quot;. As of 2024, that&#39;s still true - and from my perspective, maybe even Ethereum&#39;s greatest value. 5/5.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Eth contract data pt 3. How to run your own graph node</title>
		<link href="https://cdrn.github.io/blog/slurpingcontractdatapt3/"/>
		<updated>2023-09-05T00:00:00Z</updated>
		<id>https://cdrn.github.io/blog/slurpingcontractdatapt3/</id>
		<content type="html">&lt;p&gt;This is the third and final part unwinding the contract talk i gave at &lt;a href=&quot;https://ethmelbourne.co/&quot;&gt;eth melbourne&lt;/a&gt;.You can find the first part &lt;a href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt1/&quot;&gt;here&lt;/a&gt; and the second part &lt;a href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt2/&quot;&gt;here&lt;/a&gt; In this part, I want to talk a bit about your options when trying to index contract data at any kind of scale.&lt;/p&gt;
&lt;h2 id=&quot;getting-the-data-at-scale&quot; tabindex=&quot;-1&quot;&gt;Getting the data at scale &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt3/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In the previous two posts, we talked a bit about how storage works in ethereum - how the underlying data structures function, how you can write to storage in your contract and your best bet for querying data from the chain. In this post, I want to talk a little more about getting the data at scale. Specifically, i want to talk about my favourite approach to this: stealing Yaniv&#39;s code.&lt;/p&gt;
&lt;h2 id=&quot;setting-up-your-own-graph-node&quot; tabindex=&quot;-1&quot;&gt;Setting up your own Graph node &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt3/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://thegraph.com/&quot;&gt;TheGraph&lt;/a&gt; is a protocol that aims to be a decentralised indexer of blockchains. Whether it is decentralised or not is a moot point to us - it&#39;s nature neccessitates it being open source. This means that we have access to the source code. Even better - TheGraph protocol makes it easy for us to write our own ETLs.&lt;/p&gt;
&lt;p&gt;To cut a long story short, you can trivially run your own graph indexer by pulling down the codebase from &lt;a href=&quot;https://github.com/graphprotocol/graph-node&quot;&gt;here&lt;/a&gt;. Simply &lt;code&gt;docker-compose up&lt;/code&gt; in the &lt;code&gt;docker&lt;/code&gt; directory. You can grab an example ETL from &lt;a href=&quot;https://github.com/cdrn/example-subgraph-eth-melb&quot;&gt;here&lt;/a&gt; and just follow the instructions in the docs to deploy your ETL.&lt;/p&gt;
&lt;p&gt;If you&#39;re making an ETL for a custom set of contracts, you&#39;ll need to grab and compile the ABIs by looking at the contracts tab discussed in an earlier post from Etherescan, or your block explorer of choice. If these are your contracts, you should be able to dump the ABIs into your subgraph repo and go!&lt;/p&gt;
&lt;p&gt;Once you are up and running and you&#39;ve run the correct commands to deploy your ETL to you graph node, it will go ahead and start indexing all of the relevant blocks to construct the entire history of the contracts you have supplied to it! You can interrogate them either by a graphql dashboard exposed on localhost, or, my favourite, simply connect to the local postgres instance you are running and run your queries. Neat!&lt;/p&gt;
&lt;h2 id=&quot;cryo&quot; tabindex=&quot;-1&quot;&gt;Cryo &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt3/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Of course, as usual, paradigm has released their own tool to more or less obviate the need for any of this. Were I looking to handroll my own version of this, I might take a look at &lt;a href=&quot;https://github.com/paradigmxyz/cryo&quot;&gt;cryo&lt;/a&gt; which allows you to quickly and easily extract blockchain data to parquet.&lt;/p&gt;
&lt;h2 id=&quot;parting-remarks&quot; tabindex=&quot;-1&quot;&gt;Parting remarks &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt3/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Indexing contract data is, at this point, old news. As someone who has done it more than a few times, I&#39;d say: Try to use a prerolled solution like TheGraph or Cryo. Failing that - it&#39;s easy to have a look at these projects for a liberal dose of inpsiration. These problems have been solved before and it will greatly expedite your efforts.&lt;/p&gt;
&lt;p&gt;Feel free to check out the &lt;a href=&quot;https://drive.google.com/file/d/16ZzEvUlselU3xdTWhfhJU8rvaB7umlRW/view&quot;&gt;slide deck&lt;/a&gt; if you&#39;re still curious. Hope it helps!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Eth contract data pt 2. Storage tree, cast and RPC</title>
		<link href="https://cdrn.github.io/blog/slurpingcontractdatapt2/"/>
		<updated>2023-08-28T00:00:00Z</updated>
		<id>https://cdrn.github.io/blog/slurpingcontractdatapt2/</id>
		<content type="html">&lt;p&gt;I recently gave a talk at &lt;a href=&quot;https://ethmelbourne.co/&quot;&gt;eth melbourne&lt;/a&gt; in which i gave some tips and tricks for indexing eth contract data, as well as a brief overview of exactly &lt;em&gt;what&lt;/em&gt; contract data is on ethereum and a quick dive into the EVM. This is part two of a two part blog post - you can find the first part &lt;a href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt1/&quot;&gt;here&lt;/a&gt;. In this part, I want to cover some of your best options for getting into the yummy stuff (contract data) in both scalable and unscalable ways.&lt;/p&gt;
&lt;h2 id=&quot;what-is-the-storage-tree&quot; tabindex=&quot;-1&quot;&gt;What is the storage tree &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt2/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In our last post, we talked a little bit about how contract data is stored in a &amp;quot;patricia merkle&amp;quot; tree called the ethereum storage tree. In order to demystify this a little, I want to get into the nitty gritty of manually grabbing items off of this trie so you can see how both accessible it is and how we can build up our own state database over time&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://cdrn.github.io/img/WdB1jpd5US-300.avif 300w, https://cdrn.github.io/img/WdB1jpd5US-600.avif 600w&quot; sizes=&quot;(max-width: 991px) 300px, 600px&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://cdrn.github.io/img/WdB1jpd5US-300.webp 300w, https://cdrn.github.io/img/WdB1jpd5US-600.webp 600w&quot; sizes=&quot;(max-width: 991px) 300px, 600px&quot;&gt;&lt;source type=&quot;image/png&quot; srcset=&quot;https://cdrn.github.io/img/WdB1jpd5US-300.png 300w, https://cdrn.github.io/img/WdB1jpd5US-600.png 600w&quot; sizes=&quot;(max-width: 991px) 300px, 600px&quot;&gt;&lt;img alt=&quot;A great explanation of how the ethereum state tree works [credit here](https://ethereum.stackexchange.com/questions/6415/eli5-how-does-a-merkle-patricia-trie-tree-work)&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://cdrn.github.io/img/WdB1jpd5US-300.png&quot; width=&quot;600&quot; height=&quot;423&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Ethereum in it&#39;s current implementation (as of 2023) actually utilises &lt;a href=&quot;https://ethereum.org/en/developers/docs/data-structures-and-encoding/patricia-merkle-trie/#tries-in-ethereum&quot;&gt;3 patricia merkle trees&lt;/a&gt; which have the following useful properties:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Their lookup and retrieval time is O(k) where k is key length -- in Ethereum always 20 bytes.&lt;/li&gt;
&lt;li&gt;Leaf nodes are cryptographically verifiable by only needing to store the state of the path to the root node (the state root) - this means clients do not need the entire state of the tree to verify whether a piece of data is legitimate or not.
For this reason, storage in eth is more or less treated as a hashmap which is especially good news for us if we are interested in mass retrieval - we can be sure it will be relatively fast and we will will also be able to parallelize it (should we so choose)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The storage tree is just the Patricia Merkle Tree that stores all of the &amp;quot;storage&amp;quot; data from the execution of Eth smart contracts. If a contract requires between block, between call memory storage, this is the data structure it lives in&lt;/p&gt;
&lt;h2 id=&quot;interrogating-the-storage-state-tree&quot; tabindex=&quot;-1&quot;&gt;Interrogating the storage/state tree &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt2/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;For first time ethereum users, the best way to get a handle on the structure and operation of contract data on the chain is using foundry&#39;s &lt;a href=&quot;https://github.com/foundry-rs/foundry/tree/master/crates/cast&quot;&gt;&lt;code&gt;cast&lt;/code&gt; tool&lt;/a&gt;. Cast provides a lot of convenience and hides some of the ugliest parts of interacting with ethereum&#39;s &lt;a href=&quot;https://ethereum.org/en/developers/docs/apis/json-rpc/&quot;&gt;underlying RPC methods&lt;/a&gt; which will become obvious later in this post.&lt;/p&gt;
&lt;p&gt;Foundry is easy to install by &lt;a href=&quot;https://book.getfoundry.sh/getting-started/installation&quot;&gt;following these docs&lt;/a&gt; which I&#39;ve paraphrased below for convenience. In your terminal, run:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-L&lt;/span&gt; https://foundry.paradigm.xyz &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once foundry is installed simply run&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;foundryup&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and you should have access to the &lt;code&gt;cast&lt;/code&gt; command in your command line. You can type in &lt;code&gt;cast&lt;/code&gt; to see the subcommands available to you. This also comes with &lt;code&gt;forge&lt;/code&gt;, &lt;code&gt;anvil&lt;/code&gt;, and &lt;code&gt;chisel&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;You&#39;re going to need an ethereum node to talk to. Either you can set up and run your own locally, or more conveniently &lt;a href=&quot;https://app.infura.io/dashboard&quot;&gt;grab a free infura API key&lt;/a&gt;. Once you&#39;ve got an API URL, set the env var in your console like so&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ETH_RPC_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_INFURA_URL&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For now, let&#39;s try inspecting the state of a live smart contract to hopefully demystify the inner workings of the eth chain. The contract for the uniswap governance token lives &lt;a href=&quot;https://etherscan.io/token/0x1f9840a85d5af5bf1d1762f925bdaddc4201f984&quot;&gt;here&lt;/a&gt;. Let&#39;s grab it and see what it looks like. We can introspect the storage attached to the contract super easily with the following cast command:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;cast storage 0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Your output should look something like the following:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Name                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Type                                                         &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Slot &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Offset &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Bytes &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Value                                            &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Contract             &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;---------------------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;--------------------------------------------------------------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;--------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;-------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;--------------------------------------------------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;----------------------&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; totalSupply         &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; uint256                                                      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000000000000000000000000000&lt;/span&gt;                     &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; minter              &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; address                                                      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;151923958270022490478906441731290990705404425660&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mintingAllowedAfter &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; uint256                                                      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1704067200&lt;/span&gt;                                       &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; allowances          &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; uint96&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;               &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                                                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; balances            &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; uint96&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                                   &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                                                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; delegates           &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; address&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                                  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                                                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; checkpoints         &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uint32 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; struct Uni.Checkpoint&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                                                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; numCheckpoints      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; uint32&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                                   &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                                                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; nonces              &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; mapping&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; uint256&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                                  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                                                &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; Uni/Contract.sol:Uni &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is showing us the values stored at a given storage address in the ethereum storage tree. Neat! We can even see the values in decimal here - although keep in mind for things like &lt;code&gt;totalSupply&lt;/code&gt; this is in base units - to get the whole unit value you have to divide by &lt;code&gt;10^18&lt;/code&gt;. Cast is doing a lot behind the scenes to get us here. Something like this is taking place:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Goes to etherscan to retrieve the ABIs or Application Binary Interfaces required to interpret the deployed contracts. Without the ABIs, it&#39;s impossible to interpret the data correctly. Etherscan, Blockscout and other block explorers allow contract writers to upload &lt;a href=&quot;https://etherscan.io/token/0x1f9840a85d5af5bf1d1762f925bdaddc4201f984#code&quot;&gt;verified versions of contracts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Makes the required RPC calls which take and receive arguments in hex&lt;/li&gt;
&lt;li&gt;Translates the received RPC responses from hex to decimal (You can also use cast&#39;s build in &lt;code&gt;hex-to-dec&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;These are a few extra steps, but hypothetically anyone could go directly to the requisite ethereum RPCs and grab the data!&lt;/p&gt;
&lt;h2 id=&quot;next-steps&quot; tabindex=&quot;-1&quot;&gt;Next Steps &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt2/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Woof, that was a lot! In the next post i&#39;ll quickly go over your best and quickest ways to index ethereum contract data at scale. I&#39;ll also upload the slide deck from the talk.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Eth contract data pt 1.</title>
		<link href="https://cdrn.github.io/blog/slurpingcontractdatapt1/"/>
		<updated>2023-08-03T00:00:00Z</updated>
		<id>https://cdrn.github.io/blog/slurpingcontractdatapt1/</id>
		<content type="html">&lt;p&gt;I recently gave a talk at &lt;a href=&quot;https://ethmelbourne.co/&quot;&gt;eth melbourne&lt;/a&gt; in which i gave some tips and tricks for indexing eth contract data, as well as a brief overview of exactly &lt;em&gt;what&lt;/em&gt; contract data is on ethereum and a quick dive into the EVM. In the interest of sharing, I&#39;d like to condense my talk down into a series of blog posts.&lt;/p&gt;
&lt;h3 id=&quot;what-is-contract-data&quot; tabindex=&quot;-1&quot;&gt;What is contract data? &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt1/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;First of all, if you&#39;re not really familiar with what a smart contract is on Ethereum (and in general), there are plenty of resources out there to get up to speed. I won&#39;t be covering that in this post, but you can look &lt;a href=&quot;https://ethereum.org/en/smart-contracts/#:~:text=Smart%20contracts%20are%20the%20fundamental,if%20this%20then%20that%20structure&quot;&gt;here&lt;/a&gt; for a choose your own difficulty explanation. What I want to talk about specifically is what we mean by &lt;em&gt;contract data&lt;/em&gt; and talk a little bit about how the EVM handles memory, but more specifically &lt;em&gt;storage&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&quot;great-so-what-is-contract-storage&quot; tabindex=&quot;-1&quot;&gt;Great, so what is contract storage? &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt1/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;All of the data in Ethereum is held in a global state tree, in the form of a &lt;em&gt;Patricia Merkle Tree&lt;/em&gt;. We&#39;ll talk a little bit more about this later, but for an ethereum smart contract developer it essentially functions as a key value store.&lt;/p&gt;
&lt;p&gt;From the perspective of said developer, &lt;code&gt;storage&lt;/code&gt; is just a data store that can be used to persist state between block/contract calls. Storage is often used judiciously as it becomes very expensive very quickly. In fact, evm.codes indicates that calls to &lt;code&gt;SSTORE&lt;/code&gt; and &lt;code&gt;SLOAD&lt;/code&gt; are justifiably &lt;a href=&quot;https://www.evm.codes/#54?fork=shanghai&quot;&gt;30 times more expensive&lt;/a&gt; than their in memory counterparts. Thus, as of the time of writing, storage is reserved for memory that absolutely must be persisted in ethereum state.&lt;/p&gt;
&lt;p&gt;In solidity, calls to storage are obvious and look like the following:&lt;/p&gt;
&lt;pre class=&quot;language-solidity&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-solidity&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;uint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;storage&lt;/span&gt; _arr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can find about a million examples of this online, but suffice to say if you are declaring a variable as &lt;code&gt;storage&lt;/code&gt;, operating on it will be expensive!&lt;/p&gt;
&lt;h3 id=&quot;ethereum-state-tree&quot; tabindex=&quot;-1&quot;&gt;Ethereum state tree &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt1/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;So, we know that our &lt;code&gt;storage&lt;/code&gt; calls are being persisted somewhere on the blockchain consistently between all clients, but we don&#39;t yet know how ethereum handles said state. As alluded to earlier, all of Ethereum&#39;s state is bound up in a Patricia Merkle tree which we can dive a little deeper into to further our understanding of the system.&lt;/p&gt;
&lt;p&gt;Like all good tree implementations, the Patricia Merkle Tree is about balancing retrieval, insertion and traversal time. As the word &lt;em&gt;merkle&lt;/em&gt; implies however, this data structure has a fourth important property &lt;em&gt;cryptographic verifiability&lt;/em&gt;. Essentially what it boils down to is this: Given a piece of state and a &lt;code&gt;state root hash&lt;/code&gt;, any node can verify the integrity of that state by computing the chain of hashes along the branch of the patricia merkle tree which connects that transaction all the way back to the state root. Powerfully, this means a couple of things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Clients can be sure that a state such as the balance of their account is authentic without having to hold the entire state of the ethereum blockchain on their local machine (To date over 100GB including merkle proofs).&lt;/li&gt;
&lt;li&gt;Clients can efficiently enough retrieve and insert new states to the state tree while preserving the above principal. As we recall from our leetcodes, trie insertion time and look up is o(k) (very fast!) where K is the input size  -- in this case, clipped at 20 bytes which is the size of an ethereum address! Pretty genius!&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The actual implementation of the state tree is quite inspired, and i&#39;d recommend you look &lt;a href=&quot;https://blog.ethereum.org/2015/11/15/merkling-in-ethereum&quot;&gt;here&lt;/a&gt; if you&#39;re interested in finding out more. For the purposes of this post however, all you need to understand is that in Ethereum it&#39;s functioning as a key value store with some very interesting properties, where all the keys are 20 byte ethereum contract addresses, and some of the values are the contract data we&#39;re interested in. Neat!&lt;/p&gt;
&lt;h3 id=&quot;part-2-coming-soon&quot; tabindex=&quot;-1&quot;&gt;Part 2 (Coming soon) &lt;a class=&quot;header-anchor&quot; href=&quot;https://cdrn.github.io/blog/slurpingcontractdatapt1/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;In part two we&#39;ll discuss your options for stealing all of that yummy free contract data, why you&#39;d want to and how your approach might change depending on what you&#39;re building.&lt;/p&gt;
</content>
	</entry>
</feed>
