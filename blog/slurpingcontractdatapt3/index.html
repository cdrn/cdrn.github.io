<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eth contract data pt 3. How to run your own graph node</title>
    <meta
    name="description" content="Why buy when you can fork?">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Chris Doran">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Chris Doran">
    
    <style>
    /**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Minimal but readable styling */
:root {
	--font-family: Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
	--font-size-base: 17px;
	--line-height-base: 1.7;

	/* Light theme */
	--background-color: #ffffff;
	--text-color: #000000;
	--text-color-link: #0000ee;
	--text-color-link-visited: #551a8b;
	--text-color-muted: #666666;

	--max-width: 90ch;
}

[data-theme="dark"] {
	--background-color: #000000;
	--text-color: #00ff00;
	--text-color-link: #00ff00;
	--text-color-link-visited: #00cc00;
	--text-color-muted: #00cc00;
}

/* Basic reset */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0;
	font-family: var(--font-family);
	font-size: var(--font-size-base);
	line-height: var(--line-height-base);
	color: var(--text-color);
	background-color: var(--background-color);
	font-weight: 500;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

body {
	max-width: var(--max-width);
	margin: 0 auto;
	padding: 1em;
}

/* Header - minimal */
header {
	margin-bottom: 2em;
	padding-bottom: 1em;
	border-bottom: 1px solid var(--text-color);
}

.header-main {
	margin-bottom: 0.5em;
}

.spacer {
	display: none;
}

.home-link {
	font-weight: bold;
	color: var(--text-color);
	text-decoration: none;
}

.home-link:hover {
	text-decoration: underline;
}

/* Navigation - simple list */
.nav {
	margin: 0;
	padding: 0;
	list-style: none;
}

.nav-item {
	display: inline;
	margin-right: 1em;
}

.nav-item a {
	color: var(--text-color);
	text-decoration: none;
}

.nav-item a:hover,
.nav-item a[aria-current="page"] {
	text-decoration: underline;
}

/* Theme toggle - minimal button */
.theme-toggle {
	font-family: var(--font-family);
	padding: 2px 8px;
	margin-left: 1em;
	border: 1px solid var(--text-color);
	background: var(--background-color);
	color: var(--text-color);
	cursor: pointer;
	font-size: var(--font-size-base);
}

/* Main content */
main {
	padding: 0;
}

/* Post list - readable */
.postlist {
	list-style: none;
	padding: 0;
	margin: 0;
}

.postlist-item {
	margin-bottom: 2.5em;
	padding-bottom: 1.5em;
	border-bottom: 1px solid var(--text-color);
}

.postlist-link {
	font-weight: bold;
	font-size: 1.15em;
	color: var(--text-color);
	text-decoration: none;
	line-height: 1.4;
	display: block;
	margin-bottom: 0.5em;
}

.postlist-link:hover {
	text-decoration: underline;
}

.postlist-meta {
	margin: 0.5em 0;
	font-size: 0.9em;
	color: var(--text-color-muted);
}

.postlist-reading-time {
	margin-left: 1em;
}

.postlist-excerpt {
	margin: 0.75em 0;
	line-height: 1.6;
}

.postlist-tags {
	margin-top: 0.75em;
	font-size: 0.9em;
}

.post-tag {
	margin-right: 0.75em;
	text-decoration: none;
	color: var(--text-color-muted);
}

.post-tag:before {
	content: "[";
}

.post-tag:after {
	content: "]";
}

/* Article - minimal */
article {
	margin: 2em 0;
}

.post-metadata {
	list-style: none;
	padding: 0;
	margin: 1em 0;
}

.post-metadata li {
	display: inline;
	margin-right: 1em;
}

/* Reading time */
.reading-time {
	display: block;
	margin: 1em 0;
	padding: 0.5em 0;
	border-top: 1px solid var(--text-color);
	border-bottom: 1px solid var(--text-color);
}

/* Typography - improved hierarchy */
h1, h2, h3, h4, h5, h6 {
	font-weight: bold;
	margin-top: 1.5em;
	margin-bottom: 0.75em;
	line-height: 1.3;
}

h1 {
	font-size: 1.8em;
	margin-top: 0;
	margin-bottom: 1em;
}
h2 {
	font-size: 1.4em;
	margin-top: 2em;
}
h3 { font-size: 1.15em; }

p {
	margin: 1em 0;
}

/* Code blocks - always monospace */
pre {
	margin: 1em 0;
	padding: 0.5em;
	overflow-x: auto;
	border-left: 3px solid var(--text-color);
	font-family: "Courier New", Courier, monospace;
	font-size: 0.9em;
}

code {
	font-family: "Courier New", Courier, monospace;
	font-size: 0.9em;
}

/* Links - classic web style */
a[href] {
	color: var(--text-color-link);
	text-decoration: underline;
}

a[href]:visited {
	color: var(--text-color-link-visited);
}

a[href]:hover {
	text-decoration: none;
}

.links-nextprev {
	list-style: none;
	padding: 0;
	margin: 2em 0;
	border-top: 1px solid var(--text-color);
	padding-top: 1em;
}

.links-nextprev li {
	margin: 0.5em 0;
}

/* Two-column layout */
.two-column-layout {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 4em;
	margin: 2em 0;
}

.two-column-layout .column h2:first-child {
	margin-top: 0;
}

@media (max-width: 768px) {
	.two-column-layout {
		grid-template-columns: 1fr;
		gap: 3em;
	}
}

/* Projects - simple list */
.projects-grid {
	list-style: none;
	padding: 0;
	margin: 0;
}

.project-card {
	margin-bottom: 2em;
	padding-bottom: 1.5em;
	border-bottom: 1px solid var(--text-color);
}

.project-preview {
	max-width: 100%;
	height: auto;
	margin: 1em 0;
	border: 1px solid var(--text-color);
}

.project-title {
	font-weight: bold;
	font-size: 1.15em;
	margin: 0.5em 0;
}

.project-description {
	margin: 0.75em 0;
	line-height: 1.6;
}

.project-links {
	margin-top: 0.75em;
}

.project-link {
	margin-right: 1.5em;
}

/* Content container */
.content-container {
	margin: 2em 0;
}

/* Images */
img {
	max-width: 100%;
	height: auto;
}

/* Lists */
ul, ol {
	margin: 1em 0;
	padding-left: 2em;
}

blockquote {
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid var(--text-color);
}

/* Tables */
table {
	border-collapse: collapse;
	margin: 1em 0;
}

th, td {
	border: 1px solid var(--text-color);
	padding: 0.5em;
	text-align: left;
}

th {
	font-weight: bold;
}</style><script src="/js/theme-toggle.js"> </script>
  </head>
  <body>
    <a href="#skip" class="visually-hidden">Skip to content</a>
    <header>
      <div>
        <div class="header-main">
          <a href="/" class="home-link">Chris Doran</a>
          <div class="spacer"></div>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">DARK</button>
        </div>
        <nav>
          <ul class="nav">
              <li class="nav-item">
                <a href="/" >Home</a>
              </li>
              <li class="nav-item">
                <a href="/blog/" >All Posts</a>
              </li>
              <li class="nav-item">
                <a href="/about/" >About Me</a>
              </li>
          </ul>
        </nav>
      </div>
    </header>
    <main id="skip">
      
      
<h1>Eth contract data pt 3. How to run your own graph node</h1>

<ul class="post-metadata">
	<li><time datetime="2023-09-05">05 September 2023</time></li>
	<li><a href="/tags/ethereum/" class="post-tag">ethereum</a>, </li>
	<li><a href="/tags/thegraph/" class="post-tag">thegraph</a>, </li>
	<li><a href="/tags/forge/" class="post-tag">forge</a>, </li>
	<li><a href="/tags/contract-data/" class="post-tag">contract data</a>, </li>
	<li><a href="/tags/mempool/" class="post-tag">mempool</a>, </li>
	<li><a href="/tags/storage/" class="post-tag">storage</a></li>
</ul>

<p>This is the third and final part unwinding the contract talk i gave at <a href="https://ethmelbourne.co/">eth melbourne</a>.You can find the first part <a href="https://cdrn.github.io/blog/slurpingcontractdatapt1/">here</a> and the second part <a href="https://cdrn.github.io/blog/slurpingcontractdatapt2/">here</a> In this part, I want to talk a bit about your options when trying to index contract data at any kind of scale.</p>
<h2 id="getting-the-data-at-scale" tabindex="-1">Getting the data at scale <a class="header-anchor" href="#getting-the-data-at-scale">#</a></h2>
<p>In the previous two posts, we talked a bit about how storage works in ethereum - how the underlying data structures function, how you can write to storage in your contract and your best bet for querying data from the chain. In this post, I want to talk a little more about getting the data at scale. Specifically, i want to talk about my favourite approach to this: stealing Yaniv's code.</p>
<h2 id="setting-up-your-own-graph-node" tabindex="-1">Setting up your own Graph node <a class="header-anchor" href="#setting-up-your-own-graph-node">#</a></h2>
<p><a href="https://thegraph.com/">TheGraph</a> is a protocol that aims to be a decentralised indexer of blockchains. Whether it is decentralised or not is a moot point to us - it's nature neccessitates it being open source. This means that we have access to the source code. Even better - TheGraph protocol makes it easy for us to write our own ETLs.</p>
<p>To cut a long story short, you can trivially run your own graph indexer by pulling down the codebase from <a href="https://github.com/graphprotocol/graph-node">here</a>. Simply <code>docker-compose up</code> in the <code>docker</code> directory. You can grab an example ETL from <a href="https://github.com/cdrn/example-subgraph-eth-melb">here</a> and just follow the instructions in the docs to deploy your ETL.</p>
<p>If you're making an ETL for a custom set of contracts, you'll need to grab and compile the ABIs by looking at the contracts tab discussed in an earlier post from Etherescan, or your block explorer of choice. If these are your contracts, you should be able to dump the ABIs into your subgraph repo and go!</p>
<p>Once you are up and running and you've run the correct commands to deploy your ETL to you graph node, it will go ahead and start indexing all of the relevant blocks to construct the entire history of the contracts you have supplied to it! You can interrogate them either by a graphql dashboard exposed on localhost, or, my favourite, simply connect to the local postgres instance you are running and run your queries. Neat!</p>
<h2 id="cryo" tabindex="-1">Cryo <a class="header-anchor" href="#cryo">#</a></h2>
<p>Of course, as usual, paradigm has released their own tool to more or less obviate the need for any of this. Were I looking to handroll my own version of this, I might take a look at <a href="https://github.com/paradigmxyz/cryo">cryo</a> which allows you to quickly and easily extract blockchain data to parquet.</p>
<h2 id="parting-remarks" tabindex="-1">Parting remarks <a class="header-anchor" href="#parting-remarks">#</a></h2>
<p>Indexing contract data is, at this point, old news. As someone who has done it more than a few times, I'd say: Try to use a prerolled solution like TheGraph or Cryo. Failing that - it's easy to have a look at these projects for a liberal dose of inpsiration. These problems have been solved before and it will greatly expedite your efforts.</p>
<p>Feel free to check out the <a href="https://drive.google.com/file/d/16ZzEvUlselU3xdTWhfhJU8rvaB7umlRW/view">slide deck</a> if you're still curious. Hope it helps!</p>

<ul class="links-nextprev"><li>Previous: <a href="/blog/slurpingcontractdatapt2/">Eth contract data pt 2. Storage tree, cast and RPC</a></li><li>Next: <a href="/blog/devcon2024/">Devcon 2024 roundup</a></li>
</ul>

    </main>
    <footer></footer>
    <!-- Current page: /blog/slurpingcontractdatapt3/ -->
    <!-- 100% privacy-first analytics -->
    <script data-collect-dnt="true" async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
  </body>
</html>