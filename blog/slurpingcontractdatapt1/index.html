<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eth contract data pt 1.</title>
    <meta
    name="description" content="Basic overview of where contract data lives in ethereum">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Chris Doran">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Chris Doran">
    
    <style>
    /**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
	--mono-font: "Fira Mono", "DejaVu Sans Mono", "Liberation Mono", Menlo, monospace;
	--font-size-base: 1.125rem;
	--line-height-base: 1.7;

	/* Light theme */
	--color-gray-20: #e0e0e0;
	--color-gray-50: #666666;
	--color-gray-90: #111111;

	--background-color: #ffffff;
	--container-background: #f8f8f8;
	
	--text-color: var(--color-gray-90);
	--text-color-link: #13116c;
	--text-color-link-active: #171584;
	--text-color-link-visited: #555555;

	--border-color: #000000;
	--border-width: 2px;
	
	--max-width: 70ch;
}

[data-theme="dark"] {
	--color-gray-20: #333333;
	--color-gray-50: #999999;
	--color-gray-90: #ffffff;

	--background-color: #111111;
	--container-background: #1a1a1a;
	
	--text-color: var(--color-gray-90);
	--text-color-link: #00ff00;
	--text-color-link-active: #00ff00;
	--text-color-link-visited: #00bb00;

	--border-color: #ffffff;
}

/* Add these specific link styles after your existing link styles */
[data-theme="dark"] a[href] {
	color: var(--text-color-link);
}

[data-theme="dark"] a[href]:visited {
	color: var(--text-color-link-visited);
}

[data-theme="dark"] a[href]:hover,
[data-theme="dark"] a[href]:active {
	color: var(--text-color-link-active);
}

/* Make sure navigation links stay white */
[data-theme="dark"] .nav-item a,
[data-theme="dark"] .home-link {
	color: var(--text-color);
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

/* Skip to content styling */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Make the skip link visible when focused */
.visually-hidden:focus {
	clip: auto;
	clip-path: none;
	height: auto;
	width: auto;
	background-color: var(--background-color);
	color: var(--text-color);
	outline: var(--border-width) solid var(--border-color);
	padding: 0.5rem 1rem;
	position: fixed;
	top: 1rem;
	left: 1rem;
	z-index: 9999;
}

html,
body {
	padding: 0;
	margin: 0;
	font-family: var(--font-family);
	font-size: var(--font-size-base);
	line-height: var(--line-height-base);
	color: var(--text-color);
	background-color: var(--background-color);
}

body {
	max-width: var(--max-width);
	margin: 0 auto;
	padding: 0 1.5rem;
	font-kerning: normal;
	text-rendering: optimizeLegibility;
}

/* Header */
header {
	margin: 1rem -1rem;
	padding: 1rem;
	border: var(--border-width) solid var(--border-color);
	background: var(--container-background);
}

header > div {
	display: flex;
	align-items: center;
	justify-content: space-between;
	flex-wrap: wrap;
	gap: 1rem;
}

.header-main {
	display: flex;
	align-items: center;
	width: 100%;
	justify-content: space-between;
	gap: 1rem;
}

.spacer {
	flex-grow: 1;
	min-width: 1rem;
}

.home-link {
	font-size: 1.25rem;
	font-weight: bold;
	color: var(--text-color);
	text-decoration: none;
	text-transform: none;
}

.home-link:hover {
	text-decoration: underline;
	text-decoration-thickness: var(--border-width);
}

/* Navigation */
.nav {
	display: flex;
	gap: 1.5rem;
	align-items: center;
	margin: 0;
	padding: 0;
	list-style: none;
}

.nav-item a {
	color: var(--text-color);
	text-decoration: none;
	text-transform: none;
}

.nav-item a:hover {
	text-decoration: underline;
	text-decoration-thickness: var(--border-width);
}

.nav-item a[aria-current="page"] {
	text-decoration: underline;
	text-decoration-thickness: var(--border-width);
}

/* Theme toggle */
.theme-toggle {
	font-family: var(--font-family);
	padding: 0.5rem;
	border: var(--border-width) solid var(--border-color);
	background: var(--container-background);
	color: var(--text-color);
	cursor: pointer;
	text-transform: none;
	font-weight: bold;
}

.theme-toggle:hover {
	background: var(--text-color);
	color: var(--background-color);
}

/* Main content */
main {
	padding: 1rem 0;
}

.content-container {
	padding-top: 0;
	margin-top: 0;
}

.content-container h1 {
	margin-top: 0;
}

/* Post list */
.postlist {
	list-style: none;
	padding: 0;
	display: grid;
	gap: 1.5rem;
}

.postlist-item {
	padding: 1.25rem;
	border: var(--border-width) solid var(--border-color);
	background: var(--background-color);
	transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.postlist-item:hover {
	transform: translateY(-3px);
	box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
}

.postlist-link {
	display: block;
	margin: 0 0 0.5rem 0;
	font-size: 1.3rem;
	font-weight: 600;
	color: var(--text-color);
	text-decoration: none;
	line-height: 1.3;
}

.postlist-link:hover {
	opacity: 0.75;
}

.postlist-meta {
	display: flex;
	gap: 1rem;
	align-items: center;
	margin-bottom: 0.5rem;
	font-size: 0.875rem;
	color: var(--color-gray-50);
}

.postlist-reading-time {
	font-size: 0.875rem;
	color: var(--color-gray-50);
}

.postlist-excerpt {
	margin: 0.5rem 0;
	font-size: 1rem;
	line-height: 1.5;
	color: var(--color-gray-50);
}

.postlist-tags {
	display: flex;
	flex-wrap: wrap;
	gap: 0.5rem;
}

.post-tag {
	display: inline-block;
	padding: 0.2rem 0.5rem;
	font-size: 0.75rem;
	background: var(--color-gray-20);
	color: var(--color-gray-90);
	border-radius: 3px;
	text-decoration: none;
	font-family: var(--mono-font);
}

/* Article */
article {
	padding: 2rem;
	border: var(--border-width) solid var(--border-color);
	background: var(--container-background);
	line-height: 1.8;
	font-size: 1.125rem;
}

/* Reading time */
.reading-time {
	display: inline-block;
	padding: 0.5rem;
	margin-bottom: 2rem;
	border: var(--border-width) solid var(--border-color);
	text-transform: none;
	font-size: 0.9rem;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
	text-transform: none;
	line-height: 1.2;
	margin-top: 2.5rem;
	margin-bottom: 1rem;
}

h1 { 
	font-size: 2.25rem; 
	font-weight: 700;
}
h2 { 
	font-size: 1.75rem; 
	font-weight: 600;
}
h3 { 
	font-size: 1.4rem; 
	font-weight: 600;
}

p {
	margin-bottom: 1.5rem;
}

/* Code blocks */
pre {
	padding: 1.25rem;
	margin: 1.5rem 0;
	border: var(--border-width) solid var(--border-color);
	background: var(--container-background);
	overflow-x: auto;
	border-radius: 3px;
	font-family: var(--mono-font);
	font-size: 0.9rem;
}

code {
	padding: 0.2em 0.4em;
	background: var(--container-background);
	border: 1px solid var(--border-color);
	border-radius: 3px;
	font-family: var(--mono-font);
	font-size: 0.9em;
}

/* Links */
a[href] {
	color: var(--text-color-link);
	text-decoration: none;
	transition: opacity 0.15s ease;
}

a[href]:hover {
	opacity: 0.8;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
	html {
		font-size: 16px;
	}

	body {
		padding: 0 1rem;
	}

	header {
		margin: 1rem 0;
		width: 100%;
	}

	header > div {
		flex-direction: column;
		align-items: flex-start;
		gap: 0.75rem;
	}

	.nav {
		display: flex;
		flex-direction: row;
		align-items: center;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	article {
		padding: 1.25rem;
	}

	h1 { font-size: 1.75rem; }
	h2 { font-size: 1.5rem; }
	h3 { font-size: 1.25rem; }
}

/* Add styles for projects */
.projects-grid {
	display: grid;
	gap: 1.5rem;
}

.project-card {
	border: var(--border-width) solid var(--border-color);
	background: var(--background-color);
	padding: 1.5rem;
}

.project-card:hover {
	background: var(--text-color);
	color: var(--background-color);
}

.project-card:hover * {
	color: var(--background-color);
}

.project-preview {
	width: 100%;
	height: 150px;
	object-fit: cover;
	border: var(--border-width) solid var(--border-color);
	margin-bottom: 1rem;
}

.project-title {
	font-size: 1.25rem;
	font-weight: bold;
	margin: 0 0 1rem 0;
}

.project-description {
	margin-bottom: 1rem;
	font-size: 0.9rem;
}

.project-links {
	display: flex;
	gap: 1rem;
}

.project-link {
	text-decoration: none;
	border-bottom: var(--border-width) solid var(--border-color);
}

/* Add these styles to your existing CSS */
.home-layout {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 2rem;
	margin: 2rem 0;
}

.home-section {
	border: var(--border-width) solid var(--border-color);
	padding: 1.5rem;
	background: var(--container-background);
}

.home-section h1 {
	margin-top: 0;
	font-size: 1.5rem;
}

/* Responsive layout */
@media (max-width: 768px) {
	.home-layout {
		grid-template-columns: 1fr;
	}
	
	.projects-grid {
		grid-template-columns: 1fr;
	}
	
	.tab-buttons {
		display: flex;
		width: 100%;
	}
	
	.tab-button {
		flex: 1;
		text-align: center;
	}
}

/* Add these styles for tabs */
.tabs {
	margin: 2rem 0;
}

.tab-buttons {
	display: flex;
	gap: -2px;
	margin-bottom: -2px;
	position: relative;
}

.tab-button {
	font-family: var(--font-family);
	padding: 0.75rem 1.5rem;
	border: var(--border-width) solid var(--border-color);
	background: var(--background-color);
	color: var(--text-color);
	cursor: pointer;
	font-weight: bold;
	position: relative;
	z-index: 1;
}

.tab-button:hover {
	background: var(--container-background);
}

.tab-button.active {
	background: var(--container-background);
	border-bottom: var(--border-width) solid var(--container-background);
	z-index: 3;
}

.tab-content {
	display: none;
	border: var(--border-width) solid var(--border-color);
	padding: 2rem;
	background: var(--container-background);
	position: relative;
	z-index: 2;
}

.tab-content.active {
	display: block;
}

/* Update project cards for better contrast */
.project-card {
	border: var(--border-width) solid var(--border-color);
	background: var(--background-color);
	padding: 1.5rem;
}

.project-card:hover {
	background: var(--text-color);
	color: var(--background-color);
}

/* Update postlist items for better contrast */
.postlist-item {
	background: var(--background-color);
}

/* Add a subtle shadow to make the cards pop more */
.project-card,
.postlist-item {
	box-shadow: 4px 4px 0 var(--border-color);
}

.project-card:hover,
.postlist-item:hover {
	box-shadow: none;
	transform: translate(2px, 2px);
}</style><script src="/js/theme-toggle.js"> </script>
  </head>
  <body>
    <a href="#skip" class="visually-hidden">Skip to content</a>
    <header>
      <div>
        <div class="header-main">
          <a href="/" class="home-link">Chris Doran</a>
          <div class="spacer"></div>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">DARK</button>
        </div>
        <nav>
          <ul class="nav">
              <li class="nav-item">
                <a href="/" >Home</a>
              </li>
              <li class="nav-item">
                <a href="/blog/" >Archive</a>
              </li>
              <li class="nav-item">
                <a href="/about/" >About Me</a>
              </li>
          </ul>
        </nav>
      </div>
    </header>
    <main id="skip">
      
      
<h1>Eth contract data pt 1.</h1>

<ul class="post-metadata">
	<li><time datetime="2023-08-03">03 August 2023</time></li>
	<li><a href="/tags/ethereum/" class="post-tag">ethereum</a>, </li>
	<li><a href="/tags/thegraph/" class="post-tag">thegraph</a>, </li>
	<li><a href="/tags/forge/" class="post-tag">forge</a>, </li>
	<li><a href="/tags/contract/" class="post-tag">contract</a>, </li>
	<li><a href="/tags/data/" class="post-tag">data</a>, </li>
	<li><a href="/tags/mempool/" class="post-tag">mempool</a>, </li>
	<li><a href="/tags/storage/" class="post-tag">storage</a></li>
</ul>

<p>I recently gave a talk at <a href="https://ethmelbourne.co/">eth melbourne</a> in which i gave some tips and tricks for indexing eth contract data, as well as a brief overview of exactly <em>what</em> contract data is on ethereum and a quick dive into the EVM. In the interest of sharing, I'd like to condense my talk down into a series of blog posts.</p>
<h3 id="what-is-contract-data" tabindex="-1">What is contract data? <a class="header-anchor" href="#what-is-contract-data">#</a></h3>
<p>First of all, if you're not really familiar with what a smart contract is on Ethereum (and in general), there are plenty of resources out there to get up to speed. I won't be covering that in this post, but you can look <a href="https://ethereum.org/en/smart-contracts/#:~:text=Smart%20contracts%20are%20the%20fundamental,if%20this%20then%20that%20structure">here</a> for a choose your own difficulty explanation. What I want to talk about specifically is what we mean by <em>contract data</em> and talk a little bit about how the EVM handles memory, but more specifically <em>storage</em></p>
<h3 id="great-so-what-is-contract-storage" tabindex="-1">Great, so what is contract storage? <a class="header-anchor" href="#great-so-what-is-contract-storage">#</a></h3>
<p>All of the data in Ethereum is held in a global state tree, in the form of a <em>Patricia Merkle Tree</em>. We'll talk a little bit more about this later, but for an ethereum smart contract developer it essentially functions as a key value store.</p>
<p>From the perspective of said developer, <code>storage</code> is just a data store that can be used to persist state between block/contract calls. Storage is often used judiciously as it becomes very expensive very quickly. In fact, evm.codes indicates that calls to <code>SSTORE</code> and <code>SLOAD</code> are justifiably <a href="https://www.evm.codes/#54?fork=shanghai">30 times more expensive</a> than their in memory counterparts. Thus, as of the time of writing, storage is reserved for memory that absolutely must be persisted in ethereum state.</p>
<p>In solidity, calls to storage are obvious and look like the following:</p>
<pre class="language-solidity" tabindex="0"><code class="language-solidity"><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> _arr<span class="token punctuation">,</span></code></pre>
<p>You can find about a million examples of this online, but suffice to say if you are declaring a variable as <code>storage</code>, operating on it will be expensive!</p>
<h3 id="ethereum-state-tree" tabindex="-1">Ethereum state tree <a class="header-anchor" href="#ethereum-state-tree">#</a></h3>
<p>So, we know that our <code>storage</code> calls are being persisted somewhere on the blockchain consistently between all clients, but we don't yet know how ethereum handles said state. As alluded to earlier, all of Ethereum's state is bound up in a Patricia Merkle tree which we can dive a little deeper into to further our understanding of the system.</p>
<p>Like all good tree implementations, the Patricia Merkle Tree is about balancing retrieval, insertion and traversal time. As the word <em>merkle</em> implies however, this data structure has a fourth important property <em>cryptographic verifiability</em>. Essentially what it boils down to is this: Given a piece of state and a <code>state root hash</code>, any node can verify the integrity of that state by computing the chain of hashes along the branch of the patricia merkle tree which connects that transaction all the way back to the state root. Powerfully, this means a couple of things:</p>
<ol>
<li>Clients can be sure that a state such as the balance of their account is authentic without having to hold the entire state of the ethereum blockchain on their local machine (To date over 100GB including merkle proofs).</li>
<li>Clients can efficiently enough retrieve and insert new states to the state tree while preserving the above principal. As we recall from our leetcodes, trie insertion time and look up is o(k) (very fast!) where K is the input size  -- in this case, clipped at 20 bytes which is the size of an ethereum address! Pretty genius!</li>
</ol>
<p>The actual implementation of the state tree is quite inspired, and i'd recommend you look <a href="https://blog.ethereum.org/2015/11/15/merkling-in-ethereum">here</a> if you're interested in finding out more. For the purposes of this post however, all you need to understand is that in Ethereum it's functioning as a key value store with some very interesting properties, where all the keys are 20 byte ethereum contract addresses, and some of the values are the contract data we're interested in. Neat!</p>
<h3 id="part-2-coming-soon" tabindex="-1">Part 2 (Coming soon) <a class="header-anchor" href="#part-2-coming-soon">#</a></h3>
<p>In part two we'll discuss your options for stealing all of that yummy free contract data, why you'd want to and how your approach might change depending on what you're building.</p>

<ul class="links-nextprev"><li>Next: <a href="/blog/slurpingcontractdatapt2/">Eth contract data pt 2. Storage tree, cast and RPC</a></li>
</ul>

    </main>
    <footer></footer>
    <!-- Current page: /blog/slurpingcontractdatapt1/ -->
  </body>
</html>